/**
 * Chat Panel Redesign - Phase 1: CSS Foundation (Mobile-First)
 *
 * Feature: 003-chat-ui-redesign
 * Approach: Mobile-first responsive design with theme-aware colors
 * Breakpoints: 320px (mobile) → 576px (sm tablet) → 768px (tablet) → 992px+ (desktop)
 *
 * Key Features:
 * - Responsive panel sizing (100% mobile → 450px desktop)
 * - Slide-in animation (300ms from right)
 * - Theme-aware colors (Docusaurus CSS variables)
 * - Smooth transitions between light/dark themes
 * - GPU-accelerated animations (transform, opacity only)
 */

/* ============================================
   BASE STYLES - Mobile First (320px - 575px)
   ============================================ */

.overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: rgba(0, 0, 0, 0.5);
  z-index: 9999;
  animation: fadeIn 200ms ease-in;
}

.panel {
  /* Base: Mobile (320px-575px) - Full screen */
  position: fixed;
  top: 0;
  right: 0;
  bottom: 0;
  width: 100%;
  height: 100dvh; /* Dynamic viewport height (accounts for mobile browser UI) */

  /* Layout */
  display: flex;
  flex-direction: column;
  overflow: hidden;

  /* Styling */
  background: var(--ifm-background-surface-color, #ffffff);
  border-left: 1px solid var(--ifm-color-emphasis-300, #e0e0e0);

  /* Animation */
  animation: slideInRight 300ms cubic-bezier(0.25, 0.46, 0.45, 0.94);

  /* Smooth theme transitions */
  transition: background-color 200ms ease, border-color 200ms ease, color 200ms ease;

  /* z-index */
  z-index: 10000;
}

/* ============================================
   ANIMATIONS
   ============================================ */

@keyframes fadeIn {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}

@keyframes slideInRight {
  from {
    transform: translateX(100%);
    opacity: 0;
  }
  to {
    transform: translateX(0);
    opacity: 1;
  }
}

@keyframes fadeInUp {
  from {
    opacity: 0;
    transform: translateY(10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

/* ============================================
   LAYOUT SECTIONS
   ============================================ */

/* Header - Fixed at top */
.header {
  /* CRITICAL: position sticky with relative for absolute close button */
  position: sticky;
  top: 0;
  z-index: 10;

  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 1rem 1.5rem;
  padding-right: 70px; /* Space for absolute close button */
  min-height: 60px;

  background: var(--ifm-background-surface-color, #ffffff);
  border-bottom: 1px solid var(--ifm-color-emphasis-200, #e0e0e0);

  /* Smooth theme transitions */
  transition: background-color 200ms ease, border-color 200ms ease;
}

.title {
  margin: 0;
  font-size: 1.25rem;
  font-weight: 600;
  color: var(--ifm-color-content, #1c1e21);
  transition: color 200ms ease;
}

/* CRITICAL FIX: Close button always visible in both themes */
.closeButton {
  /* Absolute positioning in top-right corner */
  position: absolute;
  top: 1rem;
  right: 1rem;

  /* Size: 44px × 44px (touch-friendly) */
  width: 44px;
  height: 44px;
  min-width: 44px;
  min-height: 44px;

  /* Rounded button */
  border-radius: 50%;
  border: none;

  /* Font */
  font-size: 24px;
  font-weight: 700;
  line-height: 1;

  /* Layout */
  display: flex;
  align-items: center;
  justify-content: center;

  /* Cursor */
  cursor: pointer;

  /* Ensure it's above everything */
  z-index: 10;

  /* Default colors (light mode) */
  background: #e0e0e0;
  color: #1a1a1a;

  /* Smooth transitions */
  transition: all 0.2s ease;
}

.closeButton:hover {
  background: #d0d0d0;
  transform: scale(1.1);
}

.closeButton:active {
  transform: scale(0.95);
}

.closeButton:focus-visible {
  outline: 2px solid var(--ifm-color-primary, #0066cc);
  outline-offset: 2px;
}

/* Light mode: ensure visibility */
[data-theme='light'] .closeButton {
  background: #e0e0e0;
  color: #1a1a1a;
}

[data-theme='light'] .closeButton:hover {
  background: #d0d0d0;
}

/* Dark mode: ensure visibility */
[data-theme='dark'] .closeButton {
  background: #2d2d2d;
  color: #ffffff;
}

[data-theme='dark'] .closeButton:hover {
  background: #3d3d3d;
}

/* Mode Selector */
.modeSelector {
  display: flex;
  gap: 0.5rem;
  padding: 1rem 1.5rem;
  background-color: var(--ifm-background-surface-color, #ffffff);
  border-bottom: 1px solid var(--ifm-color-emphasis-200, #e0e0e0);
  transition: background-color 200ms ease, border-color 200ms ease;
}

.modeButton {
  flex: 1;
  padding: 0.75rem 1rem;
  border: 2px solid var(--ifm-color-emphasis-300, #e0e0e0);
  background-color: transparent;
  color: var(--ifm-color-emphasis-700, #666);
  border-radius: 8px;
  font-size: 0.9rem;
  font-weight: 500;
  cursor: pointer;

  /* Touch-friendly */
  min-height: 44px;

  /* Smooth transitions */
  transition: all 200ms ease;

  /* Prevent text selection on tap */
  user-select: none;
  -webkit-user-select: none;
}

.modeButton:hover {
  border-color: var(--ifm-color-primary, #0066cc);
  color: var(--ifm-color-primary, #0066cc);
}

.modeButton.active {
  background-color: var(--ifm-color-primary, #0066cc);
  border-color: var(--ifm-color-primary, #0066cc);
  color: #ffffff;
}

.modeButton:focus-visible {
  outline: 2px solid var(--ifm-color-primary, #0066cc);
  outline-offset: 2px;
}

/* Content Area - Scrollable */
.content {
  flex: 1;
  overflow-y: auto;
  overflow-x: hidden;
  padding: 1rem 1.5rem;
  background: var(--ifm-background-color, #ffffff);
  transition: background-color 200ms ease;

  /* Smooth scrolling */
  scroll-behavior: smooth;

  /* Custom scrollbar (webkit only) */
  scrollbar-width: thin;
  scrollbar-color: var(--ifm-color-emphasis-300, #e0e0e0) transparent;
}

.content::-webkit-scrollbar {
  width: 6px;
}

.content::-webkit-scrollbar-track {
  background: transparent;
}

.content::-webkit-scrollbar-thumb {
  background: var(--ifm-color-emphasis-300, #e0e0e0);
  border-radius: 3px;
}

.content::-webkit-scrollbar-thumb:hover {
  background: var(--ifm-color-emphasis-500, #999);
}

/* Footer - Fixed at bottom (Input Area) */
.inputArea {
  padding: 1rem 1.5rem;
  background: var(--ifm-background-surface-color, #ffffff);
  border-top: 1px solid var(--ifm-color-emphasis-200, #e0e0e0);

  display: flex;
  gap: 0.75rem;
  align-items: flex-end;

  /* Sticky positioning */
  position: sticky;
  bottom: 0;
  z-index: 10;

  /* Smooth theme transitions */
  transition: background-color 200ms ease, border-color 200ms ease;
}

/* ============================================
   CONTENT ELEMENTS
   ============================================ */

/* Selected Text Context (for selection mode) */
.selectedTextContext {
  margin-bottom: 1.5rem;
  padding: 1rem;
  background-color: var(--ifm-color-primary-lightest, #e7f2ff);
  border-left: 4px solid var(--ifm-color-primary, #0066cc);
  border-radius: 8px;
  transition: background-color 200ms ease, border-color 200ms ease;
}

.contextTitle {
  margin: 0 0 0.75rem 0;
  font-size: 0.875rem;
  font-weight: 600;
  color: var(--ifm-color-primary, #0066cc);
  text-transform: uppercase;
  letter-spacing: 0.5px;
  transition: color 200ms ease;
}

.contextText {
  font-size: 0.95rem;
  color: var(--ifm-color-content, #1c1e21);
  line-height: 1.6;
  font-style: italic;
  max-height: 150px;
  overflow-y: auto;
  padding: 0.75rem;
  background-color: var(--ifm-background-surface-color, #ffffff);
  border: 1px solid var(--ifm-color-emphasis-300, #e0e0e0);
  border-radius: 6px;
  transition: background-color 200ms ease, border-color 200ms ease, color 200ms ease;
}

/* Error Banner (now using ErrorMessage component) */

/* Messages List */
.messagesList {
  display: flex;
  flex-direction: column;
  gap: 1rem;
  min-height: 200px;
}

.emptyState {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  min-height: 250px;
  text-align: center;
  color: var(--ifm-color-emphasis-600, #999);
  transition: color 200ms ease;
}

.emptyStateIcon {
  font-size: 3rem;
  margin-bottom: 1rem;
  opacity: 0.6;
}

.emptyStateText {
  font-size: 1rem;
  margin: 0;
  max-width: 400px;
  line-height: 1.5;
}

/* ============================================
   MESSAGE BUBBLES
   ============================================ */

.message {
  margin-bottom: 1rem;
  padding: 1rem;
  border-radius: 12px;
  max-width: 85%;
  word-wrap: break-word;
  overflow-wrap: break-word;

  /* Fade-in animation */
  animation: fadeInUp 300ms ease-in;

  /* Smooth theme transitions */
  transition: background-color 200ms ease, border-color 200ms ease;
}

/* User Message - Right-aligned, Blue */
.userMessage {
  align-self: flex-end;
  background-color: var(--ifm-color-primary-lightest, #e7f2ff);
  border-left: 4px solid var(--ifm-color-primary, #0066cc);
  border-radius: 12px 12px 0 12px; /* Rounded except bottom-right */
}

/* AI Message - Left-aligned, Gray */
.assistantMessage {
  align-self: flex-start;
  background-color: var(--ifm-color-emphasis-100, #f5f5f5);
  border: 1px solid var(--ifm-color-emphasis-300, #e0e0e0);
  border-radius: 12px 12px 12px 0; /* Rounded except bottom-left */
}

.messageRole {
  font-size: 0.75rem;
  font-weight: 600;
  color: var(--ifm-color-emphasis-700, #666);
  text-transform: uppercase;
  letter-spacing: 0.5px;
  margin-bottom: 0.5rem;
  transition: color 200ms ease;
}

.messageText {
  font-size: 0.95rem;
  line-height: 1.6;
  color: var(--ifm-color-content, #1c1e21);
  white-space: pre-wrap;
  word-wrap: break-word;
  overflow-wrap: anywhere; /* Break very long words */
  transition: color 200ms ease;
}

/* ============================================
   CITATIONS
   ============================================ */

.citations {
  margin-top: 1rem;
  padding-top: 0.75rem;
  border-top: 1px solid var(--ifm-color-emphasis-200, #e0e0e0);
  transition: border-color 200ms ease;
}

.citationsTitle {
  font-size: 0.75rem;
  font-weight: 600;
  color: var(--ifm-color-emphasis-700, #666);
  text-transform: uppercase;
  letter-spacing: 0.5px;
  margin-bottom: 0.5rem;
  transition: color 200ms ease;
}

.citationsList {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
  margin: 0;
  padding: 0;
}

/* ============================================
   LOADING INDICATOR (now using LoadingIndicator component)
   ============================================ */

/* ============================================
   INPUT AREA COMPONENTS
   ============================================ */

.input {
  flex: 1;
  padding: 0.75rem;
  border: 1px solid var(--ifm-color-emphasis-300, #e0e0e0);
  border-radius: 8px;
  font-size: 0.95rem;
  font-family: inherit;
  line-height: 1.5;

  /* Height constraints */
  min-height: 42px;
  max-height: 120px; /* ~5 rows */
  resize: vertical;

  /* Styling */
  background-color: var(--ifm-background-color, #ffffff);
  color: var(--ifm-color-content, #1c1e21);

  /* Smooth transitions */
  transition: border-color 200ms ease, background-color 200ms ease, color 200ms ease;
}

.input:focus {
  outline: none;
  border-color: var(--ifm-color-primary, #0066cc);
  box-shadow: 0 0 0 2px var(--ifm-color-primary-lightest, #e7f2ff);
}

.input::placeholder {
  color: var(--ifm-color-emphasis-600, #999);
  opacity: 0.8;
}

.input:disabled {
  opacity: 0.6;
  cursor: not-allowed;
  background-color: var(--ifm-color-emphasis-100, #f5f5f5);
}

.sendButton {
  padding: 0.75rem 1.5rem;
  min-height: 42px;

  background-color: var(--ifm-color-primary, #0066cc);
  color: #ffffff;
  border: none;
  border-radius: 8px;

  font-size: 0.9rem;
  font-weight: 600;
  cursor: pointer;
  white-space: nowrap;

  /* Prevent text selection */
  user-select: none;
  -webkit-user-select: none;

  /* Smooth transitions */
  transition: all 200ms ease;
}

.sendButton:hover:not(:disabled) {
  background-color: var(--ifm-color-primary-dark, #0052a3);
  transform: scale(1.02);
}

.sendButton:active:not(:disabled) {
  transform: scale(0.98);
}

.sendButton:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.sendButton:focus-visible {
  outline: 2px solid var(--ifm-color-primary, #0066cc);
  outline-offset: 2px;
}

/* Input Actions Container - Voice + Send buttons */
.inputActions {
  display: flex;
  gap: 0.5rem;
  align-items: center;
  flex-shrink: 0;
}

/* ============================================
   RESPONSIVE BREAKPOINTS - Mobile First
   ============================================ */

/* Small Tablets (576px - 767px) */
@media (min-width: 576px) {
  .panel {
    width: 90%;
    max-width: 500px;
    height: 90vh;
    border-radius: 12px 0 0 12px; /* Rounded left side only */
  }
}

/* Tablets (768px - 991px) */
@media (min-width: 768px) {
  .panel {
    width: 80%;
    max-width: 500px;
    height: 85vh;
    border-radius: 12px 0 0 12px;
  }

  .message {
    max-width: 80%;
  }
}

/* Desktop (992px+) */
@media (min-width: 992px) {
  .overlay {
    background-color: rgba(0, 0, 0, 0.3); /* Lighter overlay on desktop */
  }

  .panel {
    width: 450px;
    max-width: 450px;
    height: 80vh;
    max-height: 700px;

    /* Center vertically */
    top: 50%;
    bottom: auto;
    transform: translateY(-50%);

    /* Fully rounded corners */
    border-radius: 12px;
    border: 1px solid var(--ifm-color-emphasis-300, #e0e0e0);
  }

  .message {
    max-width: 75%;
  }

  /* Adjust animation for desktop (slide in from right, vertically centered) */
  @keyframes slideInRight {
    from {
      transform: translateX(100%) translateY(-50%);
      opacity: 0;
    }
    to {
      transform: translateX(0) translateY(-50%);
      opacity: 1;
    }
  }
}

/* Large Desktop (1440px+) */
@media (min-width: 1440px) {
  .panel {
    width: 500px;
    max-width: 500px;
    max-height: 750px;
  }
}

/* ============================================
   MOBILE OPTIMIZATIONS
   ============================================ */

/* Very Small Mobile (< 375px) */
@media (max-width: 374px) {
  .header {
    padding: 0.75rem 1rem;
  }

  .title {
    font-size: 1.1rem;
  }

  .modeSelector {
    padding: 0.75rem 1rem;
    flex-direction: column; /* Stack mode buttons vertically */
  }

  .modeButton {
    width: 100%;
  }

  .content {
    padding: 1rem;
  }

  .inputArea {
    padding: 0.75rem 1rem;
    gap: 0.5rem;
  }

  .input {
    font-size: 16px; /* Prevent zoom on iOS */
    padding: 0.65rem;
  }

  .sendButton {
    padding: 0.65rem 1rem;
    font-size: 0.85rem;
  }
}

/* Touch-friendly tap targets on mobile */
@media (max-width: 767px) {
  .closeButton,
  .modeButton,
  .sendButton,
  .citationLink {
    min-height: 44px; /* Apple HIG minimum */
    min-width: 44px;
  }
}

/* ============================================
   ACCESSIBILITY - REDUCED MOTION
   ============================================ */

@media (prefers-reduced-motion: reduce) {
  *,
  *::before,
  *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
  }
}

/* ============================================
   ACCESSIBILITY - FOCUS INDICATORS
   ============================================ */

/* Ensure all interactive elements have visible focus indicators */
button:focus-visible,
a:focus-visible,
textarea:focus-visible,
select:focus-visible {
  outline: 2px solid var(--ifm-color-primary, #0066cc);
  outline-offset: 2px;
  border-radius: 4px;
}

/* ============================================
   ACCESSIBILITY - SCREEN READER ONLY TEXT
   ============================================ */

/* Screen reader only text (visually hidden but accessible) */
:global(.sr-only) {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border-width: 0;
}

/* ============================================
   RTL SUPPORT FOR URDU LANGUAGE
   ============================================ */

/* Apply RTL to message text when document direction is RTL */
:global([dir="rtl"]) .messageText {
  direction: rtl;
  text-align: right;
}

/* Flip user message alignment for RTL */
:global([dir="rtl"]) .userMessage {
  align-self: flex-start; /* Flip from flex-end to flex-start */
  border-left: none;
  border-right: 4px solid var(--ifm-color-primary, #0066cc);
  border-radius: 12px 12px 12px 0; /* Flip corner radius */
}

/* Flip assistant message alignment for RTL */
:global([dir="rtl"]) .assistantMessage {
  align-self: flex-end; /* Flip from flex-start to flex-end */
  border-radius: 12px 12px 0 12px; /* Flip corner radius */
}

/* RTL support for input area */
:global([dir="rtl"]) .input {
  direction: rtl;
  text-align: right;
}

/* RTL support for selected text context */
:global([dir="rtl"]) .selectedTextContext {
  border-left: none;
  border-right: 4px solid var(--ifm-color-primary, #0066cc);
  direction: rtl;
  text-align: right;
}

:global([dir="rtl"]) .contextText {
  direction: rtl;
  text-align: right;
}

/* ============================================
   PRINT STYLES (hide chat panel when printing)
   ============================================ */

@media print {
  .overlay,
  .panel {
    display: none !important;
  }
}
